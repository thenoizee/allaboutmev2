<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latest Activity Dashboard</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-8">

    <div class="max-w-4xl mx-auto space-y-8">
        <!-- Main title -->
        <h1 class="text-4xl font-bold text-center text-gray-900 mb-8">How is Sammy?</h1>

        <!-- Google Sheets Data -->
        <div class="bg-white p-6 rounded-2xl shadow-xl border border-gray-200">
            <h2 class="text-2xl font-semibold mb-4 text-gray-900">Daily Data</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-lg">
                <div class="bg-gray-50 p-4 rounded-xl flex justify-between items-center">
                    <span class="font-medium text-gray-600">How would SH. rate last night's sleep out of 5?</span>
                    <span id="mood" class="font-bold text-gray-900">Loading...</span>
                </div>
                <div class="bg-gray-50 p-4 rounded-xl flex justify-between items-center">
                    <span class="font-medium text-gray-600">Laptop Time:</span>
                    <span id="laptoptime" class="font-bold text-gray-900">Loading...</span>
                </div>
                <div class="bg-gray-50 p-4 rounded-xl flex justify-between items-center">
                    <span class="font-medium text-gray-600">Phone Time:</span>
                    <span id="phonetime" class="font-bold text-gray-900">Loading...</span>
                </div>
                <div class="bg-gray-50 p-4 rounded-xl flex justify-between items-center">
                    <span class="font-medium text-gray-600">How many tasks do I have to complete?:</span>
                    <span id="TTR" class="font-bold text-gray-900">Loading...</span>
                </div>
                <div class="bg-gray-50 p-4 rounded-xl flex justify-between items-center">
                    <span class="font-medium text-gray-600">Did SH. wear his retainers yesterday?:</span>
                    <span id="retainers" class="font-bold text-gray-900">Loading...</span>
                </div>
                <div class="bg-gray-50 p-4 rounded-xl flex justify-between items-center">
                    <span class="font-medium text-gray-600">Productiveness:</span>
                    <span id="productiveness" class="font-bold text-gray-900">Loading...</span>
                </div>
                <div class="bg-gray-50 p-4 rounded-xl flex justify-between items-center">
                    <span class="font-medium text-gray-600">How would SH. describe how productive his day was?:</span>
                    <span id="working" class="font-bold text-gray-900">Loading...</span>
                </div>
            </div>
        </div>

        <!-- Last.fm Data -->
        <div class="bg-white p-6 rounded-2xl shadow-xl border border-gray-200">
            <h2 class="text-2xl font-semibold mb-4 text-gray-900">Music Activity</h2>
            <div class="flex items-center space-x-6">
                <img id="album-art" src="" alt="Album art" class="w-24 h-24 rounded-lg shadow-md" style="display: none;">
                <div>
                    <p id="now-playing-status" class="text-sm font-medium text-green-600 mb-1"></p>
                    <h3 id="song-name" class="text-xl font-bold text-gray-900 mb-1">Loading...</h3>
                    <p id="artist-name" class="text-lg text-gray-600">Loading...</p>
                </div>
            </div>
        </div>

        <!-- Trakt.tv Data -->
        <div class="bg-white p-6 rounded-2xl shadow-xl border border-gray-200">
            <h2 class="text-2xl font-semibold mb-4 text-gray-900">Latest Watched</h2>
            <div class="flex items-center space-x-6">
                <!-- Sizing classes changed from w-32 h-48 to w-64 h-96 -->
                <img id="trakt-poster" src="" alt="Trakt latest watched item" class="w-64 h-96 rounded-lg shadow-md object-cover" style="display: none;">
                <div>
                    <h3 id="trakt-title" class="text-xl font-bold text-gray-900">Latest Trakt Item</h3>
                    <p id="trakt-type" class="text-lg text-gray-600">Loading...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Function to fetch data from Google Sheets
        function fetchData() {
            const sheetId = '1zFkn6MAbf_xnzsl3b605HCqCNRzNkZsuSmXe3GWAqzs';
            const apiKey = 'AIzaSyBaDaPUmaa4Fch3HHQXUZPKVKB7TOU4LfU';
            const sheetRange = 'Sheet1!A:G';

            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetRange}?key=${apiKey}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const rows = data.values;
                    if (rows && rows.length > 1) {
                        const lastRow = rows[rows.length - 1];
                        document.getElementById('mood').textContent = lastRow[0] || 'No data';
                        document.getElementById('laptoptime').textContent = lastRow[1] || 'No data';
                        document.getElementById('phonetime').textContent = lastRow[2] || 'No data';
                        document.getElementById('TTR').textContent = lastRow[3] || 'No data';
                        document.getElementById('retainers').textContent = lastRow[4] || 'No data';
                        document.getElementById('productiveness').textContent = lastRow[5] || 'No data';
                        document.getElementById('working').textContent = lastRow[6] || 'No data';
                    }
                })
                .catch(error => {
                    console.error('Error fetching latest data:', error);
                });
        }

        // Function to fetch the latest song from Last.fm
        function fetchLastFmData() {
            const lastFmApiKey = 'bbe174cee73e51f0c2ef046f2b79689b';
            const username = 'thesamsterz';
            const lastFmUrl = `https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${username}&api_key=${lastFmApiKey}&format=json&limit=1`;

            fetch(lastFmUrl)
                .then(response => response.json())
                .then(data => {
                    const recentTracks = data.recenttracks.track;
                    if (recentTracks && recentTracks.length > 0) {
                        const latestTrack = recentTracks[0];
                        const songName = latestTrack.name;
                        const artistName = latestTrack.artist['#text'];
                        const albumArt = latestTrack.image[2]['#text'];
                        const trackUrl = latestTrack.url;
                        const isNowPlaying = latestTrack['@attr'] && latestTrack['@attr'].nowplaying === 'true';

                        const songNameElement = document.getElementById('song-name');
                        if (songNameElement) {
                            songNameElement.textContent = songName || 'No song found';
                            if (trackUrl) {
                                const link = document.createElement('a');
                                link.href = trackUrl;
                                link.textContent = songName;
                                link.target = "_blank";
                                songNameElement.innerHTML = '';
                                songNameElement.appendChild(link);
                            }
                        }

                        document.getElementById('artist-name').textContent = artistName || 'No artist found';

                        if (albumArt) {
                            const albumArtElement = document.getElementById('album-art');
                            if (albumArtElement) {
                                albumArtElement.src = albumArt;
                                albumArtElement.alt = `${songName} album art`;
                                albumArtElement.style.display = 'block';
                            }
                        }

                        const nowPlayingElement = document.getElementById('now-playing-status');
                        if (nowPlayingElement) {
                            nowPlayingElement.textContent = isNowPlaying ? 'Now Playing' : 'Last Played';
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching data from Last.fm:', error);
                });
        }

        // Function to fetch the latest watched movie or episode from Trakt.tv
        // This function uses the original third-party widget URL.
        function fetchTraktData() {
            const username = 'thesamsterz';
            const traktPosterUrl = `https://trakt-widgets.vercel.app/${username}/watched/poster`;

            const posterElement = document.getElementById('trakt-poster');

            if (posterElement) {
                posterElement.src = traktPosterUrl;
                posterElement.alt = `Latest watched by ${username}`;
                posterElement.style.display = 'block';
            }

            const titleElement = document.getElementById('trakt-title');
            const typeElement = document.getElementById('trakt-type');

            if (titleElement) {
                titleElement.textContent = 'Latest Trakt Item';
            }

            if (typeElement) {
                typeElement.textContent = 'Loading...';
            }
        }

        // Fetch data immediately on page load
        window.onload = function() {
            fetchData();
            fetchLastFmData();
            fetchTraktData();

            // Automatically refresh the data every 60 seconds
            setInterval(fetchData, 60000);
            setInterval(fetchLastFmData, 60000);
            setInterval(fetchTraktData, 60000);
        };
    </script>
</body>
</html>
